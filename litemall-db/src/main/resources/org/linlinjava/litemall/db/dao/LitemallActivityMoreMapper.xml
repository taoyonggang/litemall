<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.linlinjava.litemall.db.dao.LitemallActivityMoreMapper">
  <resultMap id="BaseResultMap" type="org.linlinjava.litemall.db.domain.LitemallActivityMore">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="activity_id" jdbcType="INTEGER" property="activityId" />
    <result column="promoter_id" jdbcType="INTEGER" property="promoterId" />
    <result column="user_id" jdbcType="INTEGER" property="userId" />
    <result column="add_time" jdbcType="TIMESTAMP" property="addTime" />
    <result column="topic_add_time" jdbcType="TIMESTAMP" property="topicAddTime" />
    <result column="end_time" jdbcType="TIMESTAMP" property="endTime" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="username" jdbcType="VARCHAR" property="username" />
    <result column="nickname" jdbcType="VARCHAR" property="nickname" />
    <result column="mobile" jdbcType="VARCHAR" property="mobile" />
    <result column="orign" jdbcType="VARCHAR" property="orign" />
    <result column="deleted" jdbcType="BIT" property="deleted" />
  </resultMap>

  <resultMap id="IntegralMap" type="org.linlinjava.litemall.db.domain.IntegralSum">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="user_id" jdbcType="INTEGER" property="user_id" />
    <result column="username" jdbcType="VARCHAR" property="username" />
    <result column="nickname" jdbcType="VARCHAR" property="nickname" />
    <result column="mobile" jdbcType="VARCHAR" property="mobile" />
    <result column="avatar" jdbcType="VARCHAR" property="avatar" />
    <result column="address" jdbcType="VARCHAR" property="address" />
      <result column="integral_do" jdbcType="INTEGER" property="integral_do" />
    <result column="sum" jdbcType="INTEGER" property="sum" />
  </resultMap>

  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, activity_id, promoter_id, user_id, add_time, orign, deleted,username,nickname,mobile,topic_add_time,end_time
  </sql>
  <select id="selectMore" parameterType="org.linlinjava.litemall.db.domain.LitemallActivityMore" resultMap="BaseResultMap">
    SELECT distinct
    litemall_activity.id,
    litemall_activity.activity_id,
    litemall_activity.promoter_id,
    litemall_activity.user_id,
    litemall_activity.add_time,
    litemall_activity.orign,
    litemall_activity.deleted,
    litemall_topic.title,
    litemall_topic.add_time AS topic_add_time,
    litemall_topic.end_time,
    litemall_user.username,
    litemall_user.nickname,
    litemall_user.mobile
    FROM
    litemall_activity ,
    litemall_topic ,
    litemall_user
    WHERE 1=1 AND
    <if test="activity != null">
      <if test="activity.activityId != null">
        litemall_activity.activity_id = #{activity.activityId} AND
      </if>
      <if test="activity.promoterId != null">
        litemall_activity.promoter_id = #{activity.promoterId} AND
      </if>
      <if test="activity.addTime != null">
      litemall_activity.add_time&gt;#{activity.addTime} AND
      </if>
      <if test="activity.endTime != null">
      litemall_activity.add_time&lt;#{activity.endTime} AND
      </if>
      <if test="activity.title != null">
      litemall_topic.title like CONCAT('%',#{activity.title},'%') AND
      </if>
      <if test="activity.nickname != null">
      litemall_user.nickname like CONCAT('%',#{activity.nickname},'%') AND
      </if>
      <if test="activity.orign != null">
      litemall_activity.orign like CONCAT('%',#{activity.orign},'%') AND
      </if>
    </if>
    litemall_activity.activity_id = litemall_topic.id AND
    litemall_activity.user_id = litemall_user.id
  </select>

  <select id="selectMoreCount" parameterType="org.linlinjava.litemall.db.domain.LitemallActivityMore" resultType="int">
    SELECT count(*) as total
    FROM
    litemall_activity ,
    litemall_topic ,
    litemall_user
    WHERE 1=1 AND
    <if test="activity != null">
      <if test="activity.activityId != null">
        litemall_activity.activity_id = #{activity.activityId} AND
      </if>
      <if test="activity.promoterId != null">
        litemall_activity.promoter_id = #{activity.promoterId} AND
      </if>
      <if test="activity.addTime != null">
        litemall_activity.add_time&gt;#{activity.addTime} AND
      </if>
      <if test="activity.endTime != null">
        litemall_activity.add_time&lt;#{activity.endTime} AND
      </if>
      <if test="activity.title != null">
        litemall_topic.title like CONCAT('%',#{activity.title},'%') AND
      </if>
      <if test="activity.nickname != null">
        litemall_user.nickname like CONCAT('%',#{activity.nickname},'%') AND
      </if>
      <if test="activity.orign != null">
        litemall_activity.orign like CONCAT('%',#{activity.orign},'%') AND
      </if>
    </if>
    litemall_activity.activity_id = litemall_topic.id AND
    litemall_activity.user_id = litemall_user.id
  </select>

  <select  id="selectIntegralSum"  resultMap="IntegralMap">
    SELECT distinct
    litemall_integrals.`user_id`,
    litemall_user.username,
    litemall_user.nickname,
    litemall_user.mobile,
    litemall_user.avatar,
    litemall_user.address,
    abs(sum(litemall_integrals.`integral_do`)) as sum
    FROM
    litemall_integrals ,
    litemall_user
    WHERE 1=1 AND
    <if test="userId != null">
          litemall_integrals.`user_id`=#{userId} AND
    </if>
    <if test="integralType != null">
      litemall_integrals.`integral_type`=#{integralType} AND
    </if>
    <if test="abs != null">
      <if test="abs == true">
        litemall_integrals.`integral_do`&gt;0 AND
      </if>
      <if test="abs == false">
        litemall_integrals.`integral_do`&lt;0 AND
      </if>
    </if>
    litemall_integrals.user_id = litemall_user.id
    GROUP BY litemall_integrals.user_id,
    litemall_user.username,
    litemall_user.nickname,
    litemall_user.mobile,
    litemall_user.avatar,
    litemall_user.address
    order by abs(sum(litemall_integrals.`integral_do`)) desc
  </select>

  <select  id="selectIntegralSumCount"   resultType="int">
    select count(*) from (
    SELECT
      litemall_integrals.`user_id`
    FROM
    litemall_integrals ,
    litemall_user
    WHERE 1=1 AND
    <if test="userId != null">
          litemall_integrals.`user_id`=#{userId} AND
    </if>
    <if test="integralType != null">
      litemall_integrals.`integral_type`=#{integralType} AND
    </if>
    <if test="abs != null">
      <if test="abs == true">
      litemall_integrals.`integral_do`&gt;0 AND
      </if>
      <if test="abs == false">
        litemall_integrals.`integral_do`&lt;0 AND
      </if>
    </if>
    litemall_integrals.user_id = litemall_user.id
    GROUP BY litemall_integrals.user_id,
    litemall_user.username,
    litemall_user.nickname,
    litemall_user.mobile
    ) as a
  </select>


</mapper>